<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName api.webamp.org
    ServerAlias api.webamp.org api.webampskins.org
    ServerAdmin jordan@jordaneldredge.com

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log vhost_combined

    RequestHeader set X-Forwarded-Proto https
    ProxyPreserveHost On

    # Production (manually switch to :3001 for blue)
    # Production (manually switch to :3002 for green)
    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/

    SSLCertificateFile /etc/letsencrypt/live/api.webamp.org/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/api.webamp.org/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName skins.webamp.org
    ServerAdmin jordan@jordaneldredge.com

    ErrorLog ${APACHE_LOG_DIR}/skins-error.log
    CustomLog ${APACHE_LOG_DIR}/skins-access.log vhost_combined

    RequestHeader set X-Forwarded-Proto https
    ProxyPreserveHost On

    ProxyPass / http://localhost:3002/
    ProxyPassReverse / http://localhost:3002/

    SSLCertificateFile /etc/letsencrypt/live/skins.webamp.org/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/skins.webamp.org/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>

<VirtualHost *:443>
    ServerName blue.api.webamp.org
    ServerAdmin jordan@jordaneldredge.com

    RequestHeader set X-Forwarded-Proto https
    ProxyPreserveHost On

    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/blue.api.webamp.org/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/blue.api.webamp.org/privkey.pem
</VirtualHost>

<VirtualHost *:443>
    ServerName green.api.webamp.org
    ServerAdmin jordan@jordaneldredge.com

    RequestHeader set X-Forwarded-Proto https
    ProxyPreserveHost On

    ProxyPass / http://localhost:3002/
    ProxyPassReverse / http://localhost:3002/

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/green.api.webamp.org/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/green.api.webamp.org/privkey.pem
</VirtualHost>
</IfModule>

